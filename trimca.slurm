#!/bin/bash
#SBATCH -A bme4350
#SBATCH -p instructional
#SBATCH --nodes=1
#SBATCH --ntasks=1
#SBATCH --cpus-per-task=10
#SBATCH --time=10:00:00
#SBATCH --mem=64GB
#SBATCH --mail-type=ALL
#SBATCH --mail-user=jdc7uq@virginia.edu

DATA=/scratch/$USER/project/patients/NAD
OUTDIR=/scratch/$USER/project/patients/NAD_fastq
mkdir -p $OUTDIR

FILES1=($(ls -1 $DATA/ENCFF011NFG.fastq.gz))
file1="${FILES1[$SLURM_ARRAY_TASK_ID]}"

module purge
module load cutadapt
module load fastqc

THREE_PRIME_AD_SEQ="ACGGGCTAATATTTATCGGTGGAGCATCACGATCTCGTAT"


FIVE_PRIME_AD1_SEQ="^CAGTCG"
FIVE_PRIME_AD2_SEQ="^TGACTC"
FIVE_PRIME_AD3_SEQ="^GCTAGA"
FIVE_PRIME_AD4_SEQ="^ATCGAT"

FIVE_PRIME_AD5_SEQ="^TCGCAG"
FIVE_PRIME_AD6_SEQ="^CTCTGA"
FIVE_PRIME_AD7_SEQ="^AGAGCT"
FIVE_PRIME_AD8_SEQ="^GATATC"

FIVE_PRIME_AD9_SEQ="^CACGTG"
FIVE_PRIME_AD10_SEQ="^TGTACC"
FIVE_PRIME_AD11_SEQ="^GCGTAA"
FIVE_PRIME_AD12_SEQ="^ATACGT"

FIVE_PRIME_AD13_SEQ="^AGCGTC"
FIVE_PRIME_AD14_SEQ="^GATCCT"
FIVE_PRIME_AD15_SEQ="^CTGAAG"
FIVE_PRIME_AD16_SEQ="^TCATGA"

FIVE_PRIME_AD17_SEQ="^GCATCG"
FIVE_PRIME_AD18_SEQ="^ATGCTC"
FIVE_PRIME_AD19_SEQ="^TGCAGA"
FIVE_PRIME_AD20_SEQ="^CATGAT"

FIVE_PRIME_AD21_SEQ="^GCATCG"
FIVE_PRIME_AD22_SEQ="^ATGCTC"
FIVE_PRIME_AD23_SEQ="^TGCAGA"
FIVE_PRIME_AD24_SEQ="^CATGAT"

FIVE_PRIME_AD25_SEQ="^GTCGCA"
FIVE_PRIME_AD26_SEQ="^ACTCTG"
FIVE_PRIME_AD27_SEQ="^TAGAGC"
FIVE_PRIME_AD28_SEQ="^CGATAT"


GZ=$file1


TEMP_BASE=$SLURM_ARRAY_TASK_ID

TRIM_FILE=$OUTDIR/$TEMP_BASE"_trim.fastq"

NO_3AD_FILE=$OUTDIR/$TEMP_BASE"_NO3AD.fastq"


NO_5AD_FILE=$OUTDIR/$TEMP_BASE"_NO5AD.fastq"


TOO_SHORT_FILE=$OUTDIR/$TEMP_BASE"_SHORT_FAIL.fastq"


cutadapt -a $THREE_PRIME_AD_SEQ -e 0.25 --match-read-wildcards --untrimmed-output=$NO_3AD_FILE $GZ | cutadapt -e 0.34 --match-read-wildcards --no-indels -m 15 -O 6 -n 1 -g $FIVE_PRIME_AD1_SEQ -g $FIVE_PRIME_AD2_SEQ -g $FIVE_PRIME_AD3_SEQ -g $FIVE_PRIME_AD4_SEQ -g $FIVE_PRIME_AD5_SEQ -g $FIVE_PRIME_AD6_SEQ -g $FIVE_PRIME_AD7_SEQ -g $FIVE_PRIME_AD8_SEQ -g $FIVE_PRIME_AD9_SEQ -g $FIVE_PRIME_AD10_SEQ -g $FIVE_PRIME_AD11_SEQ -g $FIVE_PRIME_AD12_SEQ -g $FIVE_PRIME_AD13_SEQ -g $FIVE_PRIME_AD14_SEQ -g $FIVE_PRIME_AD15_SEQ -g $FIVE_PRIME_AD16_SEQ -g $FIVE_PRIME_AD17_SEQ -g $FIVE_PRIME_AD18_SEQ -g $FIVE_PRIME_AD19_SEQ -g $FIVE_PRIME_AD20_SEQ -g $FIVE_PRIME_AD21_SEQ -g $FIVE_PRIME_AD22_SEQ -g $FIVE_PRIME_AD23_SEQ -g $FIVE_PRIME_AD24_SEQ -g $FIVE_PRIME_AD25_SEQ -g $FIVE_PRIME_AD26_SEQ -g $FIVE_PRIME_AD27_SEQ -g $FIVE_PRIME_AD28_SEQ --untrimmed-output=$NO_5AD_FILE --too-short-output=$TOO_SHORT_FILE - > $TRIM_FILE



